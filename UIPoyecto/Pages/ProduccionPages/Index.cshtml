@page
@{
    ViewData["Title"] = "Produccion";
    <link rel="stylesheet" href="~/css/main.css">
}

<div>
    <div class="colum2">
        <div class="box">
            <h3 class="dl-header">Producciones Activas</h3>
            <ul class="datalist" id="prodDl">
                <li class="container colum7">
                    <div class="squer squer-active"></div>
                    <div>#758</div>
                    <div>69 pollos</div>
                    <div>Purina Plus Ultra</div>
                    <div><a href="detalleProduccion.html">Ver mas...</a></div>
                </li>
            </ul>

            <h3 class="dl-header">Historial de Produccion</h3>

            <ul class="datalist" id="histDl">
                <li class="container colum7">
                    <div class="squer squer-active"></div>
                    <div>#758</div>
                    <div>69 pollos</div>
                    <div>Purina Plus Ultra</div>
                    <div><a href="detalleProduccion.html">Ver mas...</a></div>
                </li>
            </ul>
        </div>

        <div class="box">
            <div class="formContainer">
                <div class="dateTask">
                    <div class="date-left">
                        <div id="date-number"></div>
                        <div>
                            <div id="datemonth"></div>
                            <div id="dateyear"></div>
                        </div>
                    </div>
                    <div id="dateday"></div>
                </div>
                <form class="task" onsubmit="addNewTask(event)">
                    <div class="box-detail">
                        <div class="input-box">
                            <input type="text" name="taskTitle" autocomplete="off" placeholder="Nueva Tarea">
                            <button type="submit" class="btn_addTask">+</button>
                        </div>
                    </div>
                </form>
                <div id="tasklist"></div>
            </div>
            <button type="submit" class="Primary-Button" style="width: 100%;">+ Agregar Produccion</button>
        </div>
    </div>
</div>

<script type="module">
    import CreateDropdown from "../js/ComponentesJs/DropDownComponent.js";
    import CreateTable from "../js/ComponentesJs/TableComponent.js";
    var precio;
    window.onload = async () => {

        if (typeof (localStorage) !== "undefined") {
            let themeMode = localStorage.getItem("theme");

            if (themeMode == '"dark-theme-variables"') {
                ChangeTheme();
                console.log("tumareblack")
            }
            else { console.log("tumarelight") }
        }

        function ChangeTheme() {
            document.body.classList.toggle('dark-theme-variables');
            btn_Theme.querySelector('div:nth-child(1)').classList.toggle('active');
            btn_Theme.querySelector('div:nth-child(2)').classList.toggle('active');
        };

        await cargarDataEspeciePollo();
        await cargarDataGalera();
        await cargarDDAlimento();
        FechaProd.onchange = () => {
            var fechaInicio = new Date(FechaProd.value);
            fechaInicio.setDate(fechaInicio.getDate() + 45);

            FechaSalidaProd.value = formatear(fechaInicio);
        }


    }

    const formatear = f => {
        const año = f.getFullYear();
        const mes = ("0" + (f.getMonth() + 1)).substr(-2);
        const dia = ("0" + f.getDate()).substr(-2);
        return `${año}-${mes}-${dia}`
    }

    btnGuardarProduccion.onclick = async () => {
        let url = '../api/Produccion/SaveProD';
        const prodObj = {
            IdProduccion: IdProd.value,
            Lote: LoteProd.value,
            CostoUnitLote: CostoProd.value,
            QuintDisp: QuinProd.value,
            IdAlimento: UbiLat.value,
            IdEspecie: EspecieProd.value,
            QuintUtil: CapMax.value,
            FechaSalida: FechaSalidaProd.checked,
            IdGalera: GaleraProd.value,
            IdUsuarioRegistro: 1,
            FechaDeIngreso: FechaProd.value
        }
        let response = await fetch(url, {
            method: "POST",
            headers: {
                'Content-Type': "application/json; charset = utf-8",
                'Accept': "*/*"
            },
            body: JSON.stringify(prodObj)
        });

        response = await response.json();
        alert(response);
    }





    const cargarDDAlimento = async () => {
        let url = '../api/Alimento/GetAlimentos';
        let response = await fetch(url, {
            method: "GET",
            headers: {
                'Content-Type': "application/json; charset = utf-8",
                'Accept': "*/*"
            }
        });


        response = await response.json();
        CreateDropdown(response, AlimenProd, 'nombre', 'idAlimento',);

    }


    const cargarDataEspeciePollo = async () => {
        let url = '../api/EspeciePollo/GetEspeciesNombreCompuesto';
        let response = await fetch(url, {
            method: "GET",
            headers: {
                'Content-Type': "application/json; charset = utf-8",
                'Accept': "*/*"
            }
        });


        response = await response.json();
        CreateDropdown(response, EspecieProd, "descripccion", "idEspecie", (item) => { console.log(item); });

    }

    const cargarDataGalera = async () => {
        let url = '../api/Galera/GetGalera';
        let response = await fetch(url, {
            method: "GET",
            headers: {
                'Content-Type': "application/json; charset = utf-8",
                'Accept': "*/*"
            }
        });


        response = await response.json();
        console.log(response);
        CreateDropdown(response, GaleraProd, "nombre", "idGalera", (item) => { console.log(item); });

    }
</script>








