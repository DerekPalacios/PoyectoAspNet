@page

@{
    ViewData["Title"] = "Alimentos";
    <link rel="stylesheet" href="~/css/main.css">
}


<div class="alimContainer">
    <!--<div class="colum2">
        <div class="box">
            <div class="container">
                <h3 class="datatable-header">Marca Alimentos</h3>
                <div class="box scrollable table-small">
                    <table class="datatable margin-left" id="AlimMarcasTd">
                        <thead>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>

            </div>
            <div class="container">
                <h3 class="datatable-header">Alimentos</h3>
                <div class="box scrollable table-small">
                    <table class="datatable margin-left" id="AlimTd">
                        <thead>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="box">
            <div class="formContainer">
                <div class="formTitle">Nuevo Marca</div>
                <form action="#">
                    <div class="box-detail">
                        <div hidden>
                            <input type="number" id="marcaId" />
                        </div>
                        <div class="input-box">
                            <span class="detail">Nombre de la Marca</span>
                            <input type="text" placeholder="Ingrese el Nombre de la Marca" id="marcaName" required>
                        </div>
                    </div>

                    <div class="buttons">
                        <input class="Primary-Button" type="submit" value="Registrar"  style="width: 100%" id="btnGuardarMarcaAlimento">
                    </div>
                </form>
            </div>
            <div class="formContainer">
                <div class="formTitle">Nuevo Alimento</div>
                <form action="#">
                    <div class="box-detail">
                        <div hidden>
                            <input type="number" id="alimId" />
                        </div>
                        <div class="input-box">
                            <span class="detail">Nombre Alimento</span>
                            <input type="text" placeholder="Ingrese el Nombre del Alimento" id="alimName" required>
                        </div>
                        <div class="input-box">
                            <span class="detail">Marca</span>
                            <select class="input" id="alimMarca">
                                <option value="0">
                                    Seleccione
                                </option>
                            </select>
                        </div>
                        <div class="input-box">
                            <span class="detail">Descripcion</span>
                            <input type="text" placeholder="Ingrese una breve descripcion" id="alimdesc" required>
                        </div>-->
    <!--<div class="input-box">
        <span class="detail">Semanas de implementacion</span>
        <input type="number" min="1" placeholder="Ingrese numero semanas" id="alimSem" required>
    </div>-->
    <!--</div>

                    <div class="buttons">
                        <input class="Primary-Button" type="submit" id="btnGuardarAlimento" style="width: 100%">
                    </div>
                </form>
            </div>
        </div>
    </div>-->

    <div class="colum2">
        <div class="container CenterColum">
            <input type="radio" name="slider" id="tab-1" checked>
            <input type="radio" name="slider" id="tab-2">
            <input type="radio" name="slider" id="tab-3">
            <header class="w40">
                <label for="tab-1" class="tab-1"><ion-icon name="bag"></ion-icon></label>
                <label for="tab-2" class="tab-2"><ion-icon name="ribbon"></ion-icon></label>
                <label for="tab-3" class="tab-3"><ion-icon name="analytics"></ion-icon></label>
                <div class="slider-btn"></div>
            </header>

            <section class="box">
                <div class="slider">
                    <div class="box row1">
                        <h3 class="datatable-header">Alimentos</h3>
                        <div class="box scrollable table-medium">
                            <table class="datatable" id="AlimTd">
                                <thead>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box row1">
                        <h3 class="datatable-header">Marca Alimentos</h3>
                        <div class="box scrollable table-medium">
                            <table class="datatable" id="AlimMarcasTd">
                                <thead>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box row1">
                        <h3 class="datatable-header">Linea Alimentos</h3>
                        <div class="box scrollable table-medium">
                            <table class="datatable" id="AlimLineaTd">
                                <thead>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div class="box" style="z-index: 4;">
            <div class="formContainer hiden" id="form-2">
                <div class="formTitle">Nuevo Linea</div>
                <form action="#">
                    <div class="box-detail">
                        <div hidden>
                            <input type="number" id="lineaId" />
                        </div>
                        <div class="input-box">
                            <span class="detail">Nombre de la Linea</span>
                            <input type="text" placeholder="Ingrese el Nombre de la Linea" id="lineaName" required>
                        </div>
                        <div class="input-box">
                            <span class="detail">Descripcion de la Linea</span>
                            <input type="text" placeholder="Ingrese el Descripcion" id="lineaDesc" required>
                        </div>
                        <div class="input-box">
                            <span class="detail">Marca</span>
                            <select class="input" id="alimMarca">
                                <option value="0">
                                    -Seleccione-
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="buttons">
                        <input class="Secondary-Button" type="submit" value="Cancelar" id="cancelar">
                        <input class="Primary-Button" type="submit" value="Registrar" id="btnGuardarLinealimento">
                    </div>
                </form>
            </div>
            <div class="formContainer hiden" id="form-1">
                <div class="formTitle">Nuevo Marca</div>
                <form action="#">
                    <div class="box-detail">
                        <div hidden>
                            <input type="number" id="marcaId" />
                        </div>
                        <div class="input-box">
                            <span class="detail">Nombre de la Marca</span>
                            <input type="text" placeholder="Ingrese el Nombre de la Marca" id="marcaName" required>
                        </div>
                        <div class="input-box">
                            <span class="detail">Descripcion de la Marca</span>
                            <input type="text" placeholder="Ingrese una Descripcion" id="marcaDesc" required>
                        </div>
                    </div>

                    <div class="buttons">
                        <input class="Secondary-Button" type="submit" value="Cancelar" id="cancelar">
                        <input class="Primary-Button" type="submit" value="Registrar" id="btnGuardarMarcaAlimento">
                    </div>
                </form>
            </div>
            <div class="formContainer" id="form-3">
                <div class="formTitle">Nuevo Alimento</div>
                <form action="#">
                    <div class="box-detail">
                        <div hidden>
                            <input type="number" value="0" id="alimId" />
                        </div>
                        <div class="input-box">
                            <span class="detail">Nombre Alimento</span>
                            <input type="text" placeholder="Ingrese el Nombre" id="alimName" required>
                        </div>
                        <div class="input-box">
                            <span class="detail">Linea</span>
                            <select class="input" id="alimLinea">
                                <option value="0">
                                    -Seleccione-
                                </option>
                            </select>
                        </div>
                        <div class="input-box">
                            <span class="detail">Etapa Recomendada</span>
                            <select class="input" id="alimEtapa">
                                <option value="0">
                                    -Seleccione-
                                </option>
                            </select>
                        </div>
                        <div class="input-box">
                            <span class="detail">Descripcion</span>
                            <input type="text" placeholder="Ingrese una breve descripcion" id="alimdesc" required>
                        </div>
                    </div>

                    <div class="buttons">
                        <input class="Secondary-Button" type="submit" value="Cancelar" id="cancelar">
                        <input class="Primary-Button" type="submit" value="Registrar" id="btnGuardarAlimento">                        
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="~/js/changeTheme.js" asp-append-version="true"></script>
<script src="~/js/showForms.js" asp-append-version="true"></script>

<script type="module">
    import CreateDropdown from "../js/ComponentesJs/DropDownComponent.js";
    import CreateTable from "../js/ComponentesJs/TableComponent.js";
    import GetObjectData from "../js/ComponentesJs/GetDatosByApiUrlComponent.js";
    import SaveObjectData from "../js/ComponentesJs/PutDatoByApiUrlComponent.js";
    import GetObjectDataByFilter from "../js/ComponentesJs/GetDatoByApiUrlFiltering.js";

    window.onload = async () => {

        await cargarDropdownMarca();
        await cargarDropdownLinea();
        await cargarDropdownEtapa();
        await cargarTdAlimento();
        await cargarTdMarca();
        await cargarTdLinea();

        btnGuardarMarcaAlimento.onclick = async () => {

            let url = '../api/Alimento/SaveMarcaLineaAlimento';
            const MarcaAlim = {
                idMarca: marcaId.value,
                nombre: marcaName.value,
                descripcionMarca: marcaDesc.value
            }

            await SaveObjectData(url, MarcaAlim);
            await cargarTdMarca();
            await cargarDropdownMarca();
            await cargarDropdownLinea();
            await cargarDropdownEtapa();
            limpiar();
        };

        btnGuardarAlimento.onclick = async () => {
            let url = '../api/Alimento/SaveAlimento';
            const Alimento = {
                idAlimento: alimId.value,
                nombre: alimName.value,
                idLineaAlimentoRecomendado: alimLinea.value,
                descripcion: alimdesc.value,
                idEtapaAlimentoRecomendado: alimEtapa.value
            }

            await SaveObjectData(url, Alimento);
            await cargarTdAlimento();
            await cargarDropdownMarca();
            await cargarDropdownLinea();
            await cargarDropdownEtapa();
            limpiar();
        };

        btnGuardarLinealimento.onclick = async () => {
            let url = '../api/Alimento/SaveLineaAlimento';
            const Alimento = {
                idLineaAlimento: lineaId.value,
                nombreLinea: lineaName.value,
                descripcionLinea: lineaDesc.value,
                idMarcaLinea: alimMarca.value
            }

            await SaveObjectData(url, Alimento);
            await cargarTdLinea();
            await cargarDropdownMarca();
            await cargarDropdownLinea();
            await cargarDropdownEtapa();
            limpiar();
        };
    }

    const cargarTdAlimento = async () => {
        let alimentoData = await GetObjectData("../api/Alimento/GetAlimentoCompleto");
        
        CreateTable(alimentoData, AlimTd, (item) => { editAlim(item); });
    }

    const cargarTdMarca = async () => {
        let marcaData = await GetObjectData("../api/MarcaAlimento/GetMarcaAlimento");

        CreateTable(marcaData, AlimMarcasTd, (item) => { editMarca(item); });
    }

    const cargarTdLinea = async () => {
        let marcaData = await GetObjectData("../api/Alimento/GetLineaAlimento");

        CreateTable(marcaData, AlimLineaTd, (item) => { editLinea(item); });
    }

    const cargarDropdownMarca = async () => {
        let MarcaData = await GetObjectData("../api/MarcaAlimento/GetMarcaAlimento");

        CreateDropdown(MarcaData, alimMarca, "nombre", "idMarca");
    }

    const cargarDropdownLinea = async () => {
        let MarcaData = await GetObjectData("../api/Alimento/GetLineaAlimentoSimple");

        CreateDropdown(MarcaData, alimLinea, "nombre", "idLinea");
    }

    const cargarDropdownEtapa = async () => {
        let MarcaData = await GetObjectData("../api/Alimento/GetEtapaAlimento");

        CreateDropdown(MarcaData, alimEtapa, "nombre", "idEtapa");
    }

    const editMarca = (item) => {
        marcaId.value = item.idMarca;
        marcaName.value = item.nombre;
        marcaDesc.value = item.descripcionMarca;
    };

    const editAlim = async (item) => {
        alimId.value = item.idAlimento;
        alimName.value = item.nombre;
        //alimLinea.Selectedvalue = item.idLineaAlimentoRecomendado;
        alimdesc.value = item.descripcion;
        //alimEtapa.value = item.idEtapaAlimentoRecomendado; 

        let IdLinea = await GetObjectDataByFilter("../api/Alimento/GetIdLineaAlimentoByIdAlimento", "IdAlimento", item.idAlimento);
        document.getElementById("alimLinea").querySelector("option[value='" + IdLinea + "']").selected = true;

        let IdEtapa = await GetObjectDataByFilter("../api/Alimento/GetIdEtapaAlimentoByIdAlimento", "IdAlimento", item.idAlimento);
        document.getElementById("alimEtapa").querySelector("option[value='" + IdEtapa + "']").selected = true;

    }

    const editLinea = async (item) => {
        lineaId.value = item.idLinea;
        lineaName.value = item.nombre;
        lineaDesc.value = item.descripcion;
        let idMarca = await GetObjectDataByFilter("../api/Alimento/GetIdMarcaLineaAlimentoByIdLineaAlimento", "IdLineaAlimento", item.idLinea);

        document.getElementById("alimMarca").querySelector("option[value='" + idMarca + "']").selected=true;


    }

    const limpiar = () => {
        alimId.value = 0;
        marcaId.value = 0;
        lineaId.value = 0;
        alimName.value = "";
        alimLinea.value = "";
        alimdesc.value = "";
        alimEtapa.value = "";
        marcaName.value = "";
        marcaDesc.value = "";
        lineaName.value = "";
        lineaDesc.value = "";
        alimMarca.Selectedvalue = "";
    }
</script>
















